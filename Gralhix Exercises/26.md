# Exercise 26

## Link
https://gralhix.com/ 

## Summary of problem

Find a train journey from a video and pictures

a) At which train stations did the person board and alight?

b) Identify the mode of transportation in each image.
c) Determine the type of train they rode.
d) Estimate the speed at which the train was travelling when the footage was recorded.
e) Calculate approximately how far did the person travel overall.

![photo 1](https://i.imgur.com/lJkueMv.jpeg)
![photo 2](https://i.imgur.com/O2pwOWx.jpeg)
![photo 3](https://i.imgur.com/2CvxHsl.jpeg)


<video controls>
  <source src="https://i.imgur.com/ERvAMYh.mp4" type="video/mp4"> 
</video>

![photo 4](https://i.imgur.com/A68nH1D.jpeg)


## Relevant Information

### Photo 1
- Billboard text
- Tower in back

### Photo 2
- Store "Halva"
- Ferris Wheel

### Photo 3
- Kapital Bank
- Rent a car
- license plate?

### Video
- landscape
- pair of gas stations 0:08-0:10

### Photo 4
- Bridge rail design?
- Light pole design?



## Observations/Deductions
- It looks like Asian Russia/Mongolia/Kazakhstan
    - The lack of Cyrillic text is concerning

- The file names are the format IMG_1234
    - The files don't have metadata, but we can examine them in order of the numbering scheme.
    - Hopefully this gives us something close to chronological order

## Process

#### Let's get started
We have very distinct North Asian vibes here. There is shockingly little Cyrillic text. Let's see what we're dealing with. Wikipedia has a very helpful map of the distribution of the Latin script.
[![latin script](https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/Latin_alphabet_world_distribution.svg/2560px-Latin_alphabet_world_distribution.svg.png)](https://en.wikipedia.org/wiki/Latin_script#/media/File:Latin_alphabet_world_distribution.svg)

It seems like Kazakhstan, Uzbekistan, and Turkmenistan are going to be our best bets. Apparently, [Kazakhstan](https://emerging-europe.com/news/kazakhstans-alphabet-switch-reflects-wider-societal-changes/) and [Uzbekistan](https://www.rferl.org/a/uzbekistan-aims-for-full-transition-to-latin-based-alphabet-by-2023/31099723.html) are actively working to switch over to the Latin script! Who knew?


#### Photo 1 (IMG_2597)
![photo 1 again](https://i.imgur.com/lJkueMv.jpeg)
A Google Lens check of the billboard identifies it as Uzbek, so let's start with that assumption. It also identifies the building in the background as the Chorsu Hotel in Tashkent, Uzbekistan. A little Googling for the address and hopping into Street View, we have ourselves a very strong match.

<iframe src="https://www.google.com/maps/embed?pb=!4v1719286249661!6m8!1m7!1sCAoSLEFGMVFpcE1MdDdZUEZpUFBPclhHZm9TRk52ZzFET3pwLWI1WFFiMGlzTmh4!2m2!1d41.322418!2d69.2362459!3f240.82248559928922!4f7.359127386520981!5f1.0889863562908408" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

Looking on Google Maps and Earth in approximately the place where the photographer would be is a massive market area called the Chorsu Bazaar. [This article](https://centralasia-adventures.com/en/uzbekistan/tashkent_sights/chorsu-bazar.html#images-2) has a great photo of the Bazaar, showing a few different styles of white arches, including some that we are looking for!
![arches](https://centralasia-adventures.com/image/new/4027ff68cb-2-g.jpg)

After sifting through a few travel vlogs of the bazaar, we strike gold!
<iframe width="560" height="315" src="https://www.youtube.com/embed/oKYB93ktrIc?si=hT6JrHAsi61XXV8S&amp;start=229" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

At 3:59, [Desi Traveller 10](https://www.youtube.com/@desitraveller10) gives us a *perfect* view of exactly what we're looking for. 
![thank you ](https://i.imgur.com/Gg9BksZ.png)
His 360 camera rotation makes finding the location easy as pie.

![approx photo 1](https://i.imgur.com/HT5G3kY.jpeg)

[41.326166457366796, 69.23508207551917](https://earth.google.com/web/@41.32551632,69.23527434,426.96385424a,311.89233252d,30.00000043y,179.20432983h,68.26541857t,0r/data=OgMKATA)

As for the mode of transportation, the photographer is almost certainly on foot.

#### Photo 2 (IMG_2597)
![photo 2 again](https://i.imgur.com/O2pwOWx.jpeg)
Popping **Halva Art Cafe Shop Tashkent** into Google Maps, the shadow of a giant Ferris wheel is hard to miss.
![halva ferris](https://i.imgur.com/O6x7hOn.png)

[41.32612236684587, 69.26604205012636](https://www.google.com/maps/place/Halva+Art+Cafe+Shop/@41.3255688,69.2655337,233m/data=!3m1!1e3!4m6!3m5!1s0x38ae8bbdeb9cbff5:0x34e6a1a936429ff7!8m2!3d41.3260747!4d69.2661864!16s%2Fg%2F11sr9nwknx?entry=ttu)

The photographer is surely on foot again.

#### Photo 3 (IMG_2568)
![photo 3](https://i.imgur.com/2CvxHsl.jpeg)

Just barely visible in the central left of the photo is a rent-a-car place!
![rent a car](https://i.imgur.com/naEcVCC.png)

Let's pop it into Google Maps.

Only took a few to find it. The giant sign on the top of the building ending in O was the key.

<iframe src="https://www.google.com/maps/embed?pb=!4v1719289066123!6m8!1m7!1sCAoSLEFGMVFpcE95cGNpU2RJVV83WlVZdVdJT2w2LXpzOTYtcncxdEdDV2Jncm5v!2m2!1d41.29943851012203!2d69.27261460051847!3f87.79701566117546!4f0.8840250214046392!5f0.7820865974627469" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

41.29940453491035, 69.27249296473991

There is a hint of a glare on the left side of the photo and it's taken from the middle of the road; the photographer is likely taking the picture through the window of a car.

#### Now what?
We're probably going to have to come back to the video. If we can find the location of the 4th photo, we can figure out which direction the train went, and narrow our search area for the video. For now, we know the location of the last photo taken before the train ride, so let's find the closest trains station. Stantsiya Train Station is a 4 minute drive away. That's got to be our most likely candidate. If the photographer was indeed in a car in the 3rd photo, the car is headed right toward the station!


#### Photo 4 (IMG_2747)
![photo 4](https://i.imgur.com/A68nH1D.jpeg)

Yeah that's ... not a lot to go on. Even confirming this photo is going to be rough. The license plates are blurry. Yellow taxis... *so* unique. I guess we can start with the railing and the light pole with the suns/stars.

Google Lens was drawing a blank, but it was difficult to get a good crop of the bridge, because it was at an angle. Rotating the image got us [a hit on a Wikimedia photo](https://commons.m.wikimedia.org/wiki/File:20230613_Samarkand359.jpg):

![Samarkand](https://upload.wikimedia.org/wikipedia/commons/8/81/20230613_Samarkand359.jpg)
It's tough to be 100% sure about the railing, but the hexagonal supports sure look right.

Let's dig deeper. Looking at the photographer's account, we can check out other uploads just before and after the photo. The photographer seems to be standing on a bridge overlooking this road. Here they look to their left

[![to the left](https://upload.wikimedia.org/wikipedia/commons/5/5a/20230613_Samarkand361.jpg)](https://commons.m.wikimedia.org/wiki/File:20230613_Samarkand361.jpg)

and to their right
[![to the right](https://upload.wikimedia.org/wikipedia/commons/4/4f/20230613_Samarkand360.jpg)](https://commons.m.wikimedia.org/wiki/File:20230613_Samarkand360.jpg)

This right-facing photo has some monuments that are surely distinctive enough to help geolocate this place. Google Lens instantly identifies the 
[Bibi-Khanym Mosque](https://en.wikipedia.org/wiki/Bibi-Khanym_Mosque) in Samarkand

![Bibi-Khanym Mosque](https://upload.wikimedia.org/wikipedia/commons/d/dd/%D0%9C%D0%B5%D1%87%D0%B5%D1%82%D1%8C_%D0%91%D0%B8%D0%B1%D0%B8_%D0%A5%D0%B0%D0%BD%D1%83%D0%BC._%D0%A1%D0%B0%D0%BC%D0%B0%D1%80%D0%BA%D0%B0%D0%BD%D0%B4.jpg)


From there, it's not to tough to find the same bridge on Street View in a photosphere
<iframe src="https://www.google.com/maps/embed?pb=!4v1719291712717!6m8!1m7!1sCAoSLEFGMVFpcE5pNjdER211b1hZeU1DR2lvRGh1YmhqWmJ5YWktNVoydGlsM0VF!2m2!1d39.6628342!2d66.982666!3f83.98243326290158!4f-15.052675869416177!5f0.7820865974627469" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>


and finally, going down Shah-i-Zinda Street to the next bridge, we have the location of photo 4.

<iframe src="https://www.google.com/maps/embed?pb=!4v1719291828913!6m8!1m7!1sCAoSLEFGMVFpcFBKQWpwOVNLSVdMaG5OMDg0ZjJmeXRpM0w3QUxsbWlvV1BGRU9v!2m2!1d39.66513115692958!2d66.97969364032977!3f76.06748322721245!4f-10.19639519499502!5f0.4000000000000002" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>

39.66489246194013, 66.97994858981629

This photo is again likely taken from a car -- perhaps a taxi --, and the reflection of the driver can be seen in the top right of the photo.

![reflection](https://i.imgur.com/kBB2MoV.png)

There seems to be just the one train station in Samarkand, about a 20 minute drive from photo 4.

We're done here, but let's see if we can geolocate the video, to confirm.


#### The train ride

<video controls>
  <source src="https://i.imgur.com/ERvAMYh.mp4" type="video/mp4"> 
</video>


Well, we have an approximate train route:
![train route](https://i.imgur.com/kXefAMq.jpeg)



The mountains in the back help us narrow down the region to the ~1/3 of the trip closest to Samarkand. As seen on the map, the area closer to Tashkent is much flatter farmland.

The most distinctive part of the trip was the area with two gas stations right across the street from each other at ~0:08 in the video. Here are some frames to approximate the scene.
![gas stations](https://i.imgur.com/WlSjvTf.png)

These stations are very close to the railroad and very close to each other. This is a perfect opportunity to use the [Bellingcat OpenStreetMap search tool](https://osm-search.bellingcat.com/)

We can look for fuel stations within 150m of railways in our target area! Using these settings:
![settings](https://i.imgur.com/MOEtf80.png)


We can zoom in to that area northeast of Samarkand and press search. Here are the results. 

![results](https://i.imgur.com/yrgMLeo.png)

The ones in the Samarkand city limits are unlikely, so let's check out the ones close to Jizzax (Jizzakh). Only 9 results to check!

![Jizzax](https://i.imgur.com/Fw9yPbo.png)


Aha!
![gas stations](https://i.imgur.com/a9Zie9a.png)


Hopping into Google Earth, things are lining up!
![GE](https://i.imgur.com/NGakNJm.png)
![gas stations](https://i.imgur.com/WlSjvTf.png)

40.09786935479398, 67.80295028645132



From there, we can find the first frame
![first frame](https://i.imgur.com/wGQJUFW.png)


and the last one
![last frame](https://i.imgur.com/4Ca2ZZO.png)

and use the Google Maps Measure Distance tool to find our trip length
![distance](https://i.imgur.com/txOSEP1.png)


To find the exact time it took, we can use `ffmpeg` in the command-line and overlay a precise timestamp on the video
using 

```
ffmpeg -i "input.mp4" -filter:v "drawtext=text='%{pts\:hms}': x=(w-tw)/2: y=h-(2*lh): fontcolor=white: box=1: boxcolor=0x00000000@1: fontsize=(h/10)" "output.mp4"
```

This step is not strictly necessary to get an estimate but we might as well get it while we're here.


![](https://i.imgur.com/RhXyOE0.png)

Travelling 3777 feet in 31.533s gives us a speed of **81.6677 mph**  (131.431 km/h)

We can estimate the distance between Samarkand and Tashkent to be in the neighborhood of ~330km using the Google Maps measure distance tool, and [this timetable](https://www.advantour.com/us/uzbekistan/trains/timetable.htm) gives an estimated train travel time between the two cities as ~2h15m on the Afrosiyob high-speed line. 


![timetable](https://i.imgur.com/0bjesYo.png)

This yields an average speed of ~150 km/h, certainly within the realm of possibility for our calcuation of 131km/h! [Wikipedia says that this train has a max speed of 250km/h](https://en.wikipedia.org/wiki/Tashkent%E2%80%93Bukhara_high-speed_rail_line), so it's certainly capable of going 130km/h.


#### Total distance

##### Our journey in Tashkent
(Photo 1 - Photo 2 - Photo 3 - Stantsiya Train Station): 8.8km

![tashkent trip](https://i.imgur.com/xpfnecI.png)

##### Train ride
~330km

##### Our journey in Samarkand
(Samarkand Train Station - Photo 4): 5.3km

![samarkand trip](https://i.imgur.com/HqTs6NQ.png)

##### Grand total
8.8 + ~330 + 5.3 = ~344.1 km


## Solution

a) Stantsiya (Tashkent) - Samarkand (Samarkand)

b) 
  1) On foot 
  2) On foot 
  3) Car/Taxi
  4) Train
  5) Car/Taxi


c) Afrosiyob high-speed line
d) 81.6677 mph  (131.431 km/h)
e) ~344.1 km

#### Time Estimate
120-160 mins